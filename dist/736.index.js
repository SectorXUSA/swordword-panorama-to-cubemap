(()=>{function t(t,a,n){return Math.min(n,Math.max(t,a))}function a(t,a){return(t%a+a)%a}function n(a,n,o,r){const{width:e,height:h,data:c}=a,i=2*o,s=e-1,l=h-1,M=new Array(4),f=new Array(4);return(a,h,d)=>{const u=Math.floor(a),x=Math.floor(h),y=u-o+1,z=x-o+1;for(let t=0;t<i;t++)M[t]=r(a-(y+t)),f[t]=r(h-(z+t));for(let a=0;a<3;a++){let o=0;for(let n=0;n<i;n++){const r=t(z+n,0,l);let h=0;for(let n=0;n<i;n++){const o=(g=t(y+n,0,s),4*(r*e+g));h+=c[o+a]*M[n]}o+=h*f[n]}n.data[d+a]=Math.round(o)}var g}}const o={pz:(t,a,n)=>{t.x=-1,t.y=-a,t.z=-n},nz:(t,a,n)=>{t.x=1,t.y=a,t.z=-n},px:(t,a,n)=>{t.x=a,t.y=-1,t.z=-n},nx:(t,a,n)=>{t.x=-a,t.y=1,t.z=-n},py:(t,a,n)=>{t.x=-n,t.y=-a,t.z=1},ny:(t,a,n)=>{t.x=n,t.y=-a,t.z=-1}};function r({data:r,face:e,rotation:h,interpolation:c,maxWidth:i=1/0}){const s=Math.min(i,r.width/4),l=s;console.log("face",e);const M={},f=o[e],d=new ImageData(s,l),u="linear"===c?function(a,n){const{width:o,height:r,data:e}=a,h=(t,a)=>4*(a*o+t);return(a,c,i)=>{const s=t(Math.floor(a),0,o-1),l=t(Math.ceil(a),0,o-1),M=a-s,f=t(Math.floor(c),0,r-1),d=t(Math.ceil(c),0,r-1),u=c-f,x=h(s,f),y=h(l,f),z=h(s,d),g=h(l,d);for(let t=0;t<3;t++){const a=e[x+t]*(1-M)+e[y+t]*M,o=e[z+t]*(1-M)+e[g+t]*M;n.data[i+t]=Math.ceil(a*(1-u)+o*u)}}}(r,d):"cubic"===c?n(r,d,2,(t=>{const a=(t=Math.abs(t))*t,n=t*t*t;return t<=1?1.5*n-2.5*a+1:-.5*n- -2.5*a+-4*t- -2})):"lanczos"===c?n(r,d,5,(t=>{if(0===t)return 1;{const a=Math.PI*t;return 5*Math.sin(a)*Math.sin(a/5)/(a*a)}})):function(a,n){const{width:o,height:r,data:e}=a;return(a,h,c)=>{const i=(s=t(Math.round(a),0,o-1),4*(t(Math.round(h),0,r-1)*o+s));var s;for(let t=0;t<3;t++)n.data[c+t]=e[i+t]}}(r,d);for(let t=0;t<s;t++)for(let n=0;n<l;n++){const o=4*(n*s+t);d.data[o+3]=255,f(M,2*(t+.5)/s-1,2*(n+.5)/l-1);const e=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z),c=a(Math.atan2(M.y,M.x)+h,2*Math.PI),i=Math.acos(M.z/e);u(r.width*c/Math.PI/2-.5,r.height*i/Math.PI-.5,o)}postMessage(d)}onmessage=function({data:t}){console.log("data",t),r(t)}})();